{% extends 'base.html' %}

{% block content %}
            Total Products: {{ products|length }}
          <div class="row">
            {% for product in products %}
            <div class="col-md-4">
              <div class="card mb-4 box-shadow">
                {% if product.image %}
                <img class="card-img-top" src="{{ product.image.url }}">
                {% else %}
                <img class="card-img-top" data-src="holder.js/100px225?theme=thumb&bg=55595c&fg=eceeef&text=Thumbnail" alt="Card image cap">
                {% endif %}
                <div class="card-body">
                  <p class="card-text">
                      <b>{{ product.name }}</b><br/>
                      <b>Price: </b>{{ product.price }}  &dollar;<br/>
                      <br>
                      {{ product.description }}
                  </p>
                  <div class="d-flex justify-content-between align-items-center">
                    <div class="btn-group">
                      <button type="button" class="btn btn-sm btn-outline-secondary">Details</button>
                        {% if perms.core.can_buy %}
                        <a href="{% url 'core:cart_add' product.id %}" data-id="{{ product.id }}" class="btn btn-sm btn-outline-secondary add-to-cart-link">Add to cart</a>
                        {% endif %}
                    </div>
                    {# print discount #}
                    <small class="text-muted">{% spaceless %}
                        {% if product.discount > -1 %}
                            {{ product.discount }}%
                        {% endif %}
                    {% endspaceless %}</small>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
            <script type="text/javascript">
            $('.add-to-cart-link').click(function(e){
                target_link = $(this).attr('href');
                $.get(target_link, function (res, status, xhr){
                    console.log(res);
                    item_count = Object.keys(res).length;
                    $('#cart-count').html(item_count);
                });
                e.preventDefault();
                return false;
            });
            </script>
          </div>
{% endblock %}